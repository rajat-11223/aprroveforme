<div class="container-fluid">
  <div class="row-fluid">
    <div class="span9">
      <%= simple_form_for(@approval, :html => { :class => 'form-inline' }) do |f| %>
      <%= f.error_notification %>
      <%= f.input :title, :placeholder => "Give it a title" , :input_html => { :class => "span10" }%>
      <%= f.input :link, :placeholder => "Link to thing you want approved", :input_html => { :class => "span10" } %>
      <%= f.input :description, :placeholder => "What kind of feedback are you looking for?", :input_html => { :class => "span10", :rows => "3" } %>
      <% #f.input :deadline, as: :date, :default => Date.today+1, :input_html => { :class => "inline span10"} %>
      <% #f.input :deadline, :type=>"text", :default => Date.today+1, :input_html => { :class => "inline span10", :id=>"datepicker"} %>

      <%= f.input :deadline, :required => true, 
            :input_html => { 
              :id => "datepicker", 
              :value => (@approval.deadline.strftime("%m/%d/%Y") if @approval.deadline)}, 
            :as => :string
            %>

    <!-- <p>Date: <input type="text" id="datepicker" name="approval[deadline]" /></p> -->


</select>
      </br>
      Who will be signing off on this approval?</br>
      <%= f.error :approvers, :class=>"alert alert-error" %>
      <table class="table-condensed">
        <tr>
          <td>Name</td><td>Email Address</td><td>Required?</td>
        </tr>
      <%= f.simple_fields_for :approvers do |builder| %>
        <%= render 'approver_form', :f => builder %> 
      <% end %>


      <!-- leave the tr add row for adding new approvers -->
      <tr class="add">
      </tr>
      <!-- end extra tr -->

      </table>
  
      <p>
      
      <%= button_to_add_fields('Add Approver', f, :approvers)%>
      
      </p>
      </br>
      <%= f.button :submit, :class => "btn-primary" %>  
      <% if f.object.new_record? %>
      <%= link_to 'Cancel', root_url, :class=>"btn" %>
      <% else %>
      <%= link_to 'Back', @approval, :class=>"btn" %>
      <% end %>
 
  
    </div>


    <div class="span3">
      <div id="result"></div>
      
      
    </div>
  </div>
</div>

<% end %>

 <!-- The standard Google Loader script. -->
    <script src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">

    // Use the Google Loader script to load the google.picker script.
    google.setOnLoadCallback(createPicker);
    google.load('picker', '1');

    // Create and render a Picker object for searching images.
    function createPicker() {
         var view = new google.picker.View(google.picker.ViewId.DOCS);
          //view.setMimeTypes("image/png,image/jpeg,image/jpg");    
          var picker = new google.picker.PickerBuilder()
          .enableFeature(google.picker.Feature.NAV_HIDDEN)
          //.enableFeature(google.picker.Feature.MULTISELECT_ENABLED)
          .setAppId("<%= ENV['GOOGLE_ID']%>")
          .setOAuthToken("<%= current_user.token %>") //Optional: The auth token used in the current Drive API session.
          .addView(view)
          .addView(new google.picker.DocsUploadView())
          .setCallback(pickerCallback)
          .build();
       picker.setVisible(true);

    }

    // A simple callback implementation.
    function pickerCallback(data) {
      var url = 'nothing';
      if (data[google.picker.Response.ACTION] == google.picker.Action.PICKED) {
        var doc = data[google.picker.Response.DOCUMENTS][0];
        url = doc[google.picker.Document.URL];
      }
      var message = 'You picked: ' + url;
      document.getElementById('result').innerHTML = message;
    }
    </script>


<script type="text/javascript">
function add_fields(link, association, content) {
  var new_id = new Date().getTime();
  var regexp = new RegExp("new_" + association, "g");
  //document.body.insertBefore(content.replace(regexp, new_id), $('div#insert'));
  $("tr.add").before(content.replace(regexp, new_id));
  //$(link).before(content.replace(regexp, new_id));
}

$(function() {
    $( "#datepicker" ).datepicker(  );
  });

</script>